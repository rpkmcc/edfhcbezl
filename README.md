# MovieAPI

## **Tech stack**

- Python 3.11+
- FastAPI
- SQLite
- **Docker** & **Docker-Compose**

## Building the containers

- To run the **MovieAPI** please follow below:

### (1) Clone

```bash
git clone https://github.com/rpkmcc/edfhcbezl.git
cd edfhcbezl
```

### (2) Running with Docker Compose

```bash
- docker compose build
- docker compose up -d
```

### (3) API

- The OpenAPI interactive docs generated by FastAPI are available at **<http://localhost:8000/docs>**

## Architecture

- I utilized containerization to deploy the movieAPI.
- The MovieLens dataset **(small)** is ingested and stored in a sqlitedb (movieapi.db).
- Normalized Tables created within DB are: **Movies, Ratings, Genres**
- To persist the DB on each, I utilised docker-compose and used named volume mount. A rudimentary check is applied at run time to see if the DB needs to be seeded again if data is not present in DB.

## Curl quick test

```bash
# Hello World
curl -s http://127.0.0.1:8000/api/v1

# get movie my id
curl -s http://127.0.0.1:8000/api/v1/movies/1

# get movies by recommendation - recommend action movies from 2018
curl -s http://127.0.0.1:8000/api/v1/movies/search?q=recommend%20action%20movies%20from%202018&limit=25
```

## Testing
```bash
pytest .\tests\ -v (only run if api is running)
pytest -v -m "not e2e" (can run without api)
```
## Dev

### Useful Commands for local running

```bash
- docker compose down -v
- docker compose up --build -d
- pip install -e '.[dev]'
- docker build -t movieapi:latest .
- docker run -d --name movieapi -p 127.0.0.1:8000:8000  movieapi:latest
- fastapi dev 
```